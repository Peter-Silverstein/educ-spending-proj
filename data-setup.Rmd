---
title: "data-setup"
author: "Peter Silverstein"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
```

# Loading Data
```{r}
trips <- read.csv(here("raw-data","Household_Travel_Survey_Trips.csv")) %>%
  dplyr::select(trip_id,
                person_id,
                travel_dow,
                svy_complete,
                depart_time_hour,
                origin_tract10,
                dest_tract10,
                distance_miles,
                duration_minutes,
                speed_mph,
                mode_1,
                ObjectId) %>%
  mutate(mode_1 = as.factor(mode_1)) %>%
  mutate(travel_dow = as.factor(travel_dow)) %>%
  mutate(svy_complete = as.factor(svy_complete)) %>%
  # Collapsing the travel mode categories into 4 umbrella categories
  mutate(mode_collapsed = fct_collapse(mode_1, 
                    personalvehicle = c('Household vehicle 1',
                                        'Other non-household vehicle',
                                        'Car from work',
                                        'Household vehicle 3',
                                        'Household vehicle 2',
                                        'Other hired service (Uber, Lyft, or other smartphone-app car service)',
                                        "Friend/colleague's car",
                                        'Other vehicle in household',
                                        'Carshare service (e.g., Turo, Zipcar, ReachNow)',
                                        'Rental car',
                                        'Taxi (e.g., Yellow Cab)',
                                        'Household vehicle 4',
                                        'Other motorcycle/moped/scooter',
                                        'Household vehicle 6',
                                        'Other motorcycle/moped',
                                        'Household vehicle 5',
                                        'Household vehicle 7',
                                        'Household vehicle 8',
                                        'Personal scooter or moped (not shared)',
                                        'Carshare service (e.g., Turo, Zipcar, Getaround, GIG)',
                                        "Other motorcycle (not my household's)",
                                        'Other hired car service (e.g., black car, limo)',
                                        'Other motorcycle in household'),
                    masstransit = c('Bus (public transit)',
                                    'Private bus or shuttle',
                                    'Vanpool',
                                    'Urban Rail (e.g., Link light rail, monorail)',
                                    'School bus',
                                    'Ferry or water taxi',
                                    'Other rail (e.g., streetcar)',
                                    'Other bus (rMove only)',
                                    'Paratransit',
                                    'Commuter rail (Sounder, Amtrak)',
                                    'Urban Rail (e.g., Link light rail, monorail, streetcar)',
                                    'Other rail'),
                   activetransit = c('Bicycle or e-bike (rSurvey only)',
                                     'Walk (or jog/wheelchair)',
                                     'Skateboard or rollerblade',
                                     "Standard bicycle (my household's)",
                                     "Electric bicycle (my household's)",
                                     'Bike-share - electric bicycle',
                                     'Other rented bicycle',
                                     "Borrowed bicycle (e.g., a friend's)",
                                     'Bike-share - standard bicycle',
                                     'Bike-share bicycle (rMove only)',
                                     'Bicycle owned by my household (rMove only)',
                                     'Borrowed bicycle (e.g., from a friend) (rMove only)',
                                     'Other rented bicycle (rMove only)'),
                   other = c('Other mode (e.g., skateboard, kayak, motorhome, etc.)',
                             'Airplane or helicopter',
                             'Scooter or e-scooter (e.g., Lime, Bird, Razor)',
                             'Scooter-share (e.g., Bird, Lime)',
                             'Other scooter, moped, skateboard',
                             'Vehicle ferry (took vehicle on board)',
                             'Segway or Onewheel/electric unicycle'))) %>%
  # Filtering out fishy and irrelevant responses
  filter(svy_complete == "Complete") %>%
  filter(distance_miles <= 150) %>%
  filter(distance_miles > 0) %>%
  filter(duration_minutes > 0) %>%
  filter(speed_mph <= 150) %>%
  filter(mode_1 != "Missing Response")

persons <- read.csv(here("raw-data","Household_Travel_Survey_Persons.csv")) %>%
  dplyr::select(person_id, 
                num_trips,
                age, 
                gender, 
                sexuality, 
                race_category, 
                employment, 
                workplace, 
                commute_freq, 
                education)

combined_df <- trips %>%
  left_join(persons, by = "person_id")

head(combined_df)
summary(combined_df)
```

